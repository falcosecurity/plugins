name: Build dummy_c plugin
on:
  pull_request:
    branches: [main]
    paths:
      - "plugins/dummy_c/**"
  push:
    branches: [main]
    paths:
      - "plugins/dummy_c/**"
  workflow_dispatch:

# Checks if any concurrent jobs under the same pull request or branch are being executed
concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
  build:
    name: build
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout ‚§µÔ∏è
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          fetch-depth: 0

      - name: Install deps ‚õìÔ∏è
        run: |
          sudo apt update -y
          sudo apt install -y --no-install-recommends build-essential

      - name: Initialize CodeQL
        uses: github/codeql-action/init@89a39a4e59826350b863aa6b6252a07ad50cf83e # v4.32.4
        with:
          languages: cpp

      - name: Build dummy_c plugin üèóÔ∏è
        run: |
          cd plugins/dummy_c
          make libdummy_c.so

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@89a39a4e59826350b863aa6b6252a07ad50cf83e # v4.32.4

  formatting-check:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout code
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

      - name: Install clang-format
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y -qq clang-format-14

      - name: Run clang-format style check
        env:
          PR_HEAD_SHA: ${{ github.event.pull_request.head.sha }}
        run: .github/clang-format-check.sh 14 plugins/dummy_c
